<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>5x Sit-to-Stand Test (5xSTS)</title>

  <!-- Zentrale Styles -->
  <link rel="stylesheet" href="app-style.css">

  <!-- Bibliotheken fÃ¼r PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="robotoBase64.js"></script>
</head>

<body class="assessment-page">

  <!-- HEADER -->
  <h1>5x Sit-to-Stand Test (5xSTS)</h1>
  <p class="subtitle">
    Test zur Beurteilung der funktionellen Beinkraft, Balance und MobilitÃ¤t. 
    Bestandteil vieler geriatrischer und neurologischer Assessments.
  </p>
  <p>
    DurchfÃ¼hrung: Patient sitzt auf einem stabilen Stuhl (ca. 46 cm HÃ¶he), 
    Arme verschrÃ¤nkt vor der Brust. Aufgabe: 5-mal so schnell wie mÃ¶glich aufstehen und wieder hinsetzen. 
    Zeit wird ab Startsignal bis zur vollstÃ¤ndigen Streckung beim 5. Aufstehen gemessen.
  </p>
  <p>
    Im Cenplex-Behandlungsplan als <strong>Messung</strong> dokumentieren. 
    Hier eintragen fÃ¼r Normwerte:
  </p>

  <!-- CONTENT -->
  <form id="form5xsts">
    <label>Gemessene Zeit (Sekunden):</label>
    <input type="number" id="time" step="0.1" />

    <label>Alter:</label>
    <input type="number" id="age" min="18" max="100" />

    <label>Geschlecht:</label>
    <select id="sex">
      <option value="men">MÃ¤nnlich</option>
      <option value="women">Weiblich</option>
    </select>

    <button type="button" class="primary" id="toggleBtn5xSTS" onclick="toggleNorms5xSTS()">ğŸ“Š Normwerte anzeigen</button>
    <button type="button" class="secondary" onclick="generatePDF()">ğŸ“„ Als PDF speichern</button>
  </form>

  <!-- NORMWERTE -->
  <div id="normwerte5xSTS" class="hidden"></div>

  <!-- RESULT & NAVIGATION -->
  <div id="result"></div>

  <div class="footer-nav">
    <button class="secondary" onclick="goBack()">â¬…ï¸ ZurÃ¼ck</button>
    <button class="primary" onclick="goHome()">ğŸ  Hauptseite</button>
  </div>

  <!-- LOGIK -->
  <script>
    let normVisible = false;

    // Durchschnittswerte (Whitney et al. 2005)
    const norms5xSTS = {
      men: {
        20: 6.0, 30: 6.5, 40: 7.0, 50: 8.0, 60: 10.0, 70: 12.0, 80: 14.0
      },
      women: {
        20: 6.5, 30: 7.0, 40: 7.5, 50: 8.5, 60: 10.5, 70: 12.5, 80: 15.0
      }
    };

    function getNearestAgeGroup5xSTS(age) {
      const groups = [20, 30, 40, 50, 60, 70, 80];
      return groups.reduce((a, b) =>
        Math.abs(b - age) < Math.abs(a - age) ? b : a
      );
    }

    function toggleNorms5xSTS() {
      const btn = document.getElementById("toggleBtn5xSTS");
      const div = document.getElementById("normwerte5xSTS");

      if (normVisible) {
        div.classList.add("hidden");
        btn.innerText = "ğŸ“Š Normwerte anzeigen";
        normVisible = false;
        return;
      }

      const time = parseFloat(document.getElementById("time").value);
      const age = parseInt(document.getElementById("age").value);
      const sex = document.getElementById("sex").value;

      if (isNaN(time) || isNaN(age)) {
        div.innerText = "Bitte gÃ¼ltige Werte eingeben.";
        div.classList.remove("hidden");
        return;
      }

      const ageGroup = getNearestAgeGroup5xSTS(age);
      const ref = norms5xSTS[sex][ageGroup];
      let interpretation = "";

      if (time <= ref - 2) interpretation = "Ã¼berdurchschnittlich";
      else if (time <= ref + 2) interpretation = "im Normbereich";
      else interpretation = "unterdurchschnittlich";

      div.innerHTML = `
        <h3>Referenzwerte (${ageGroup} J., ${sex === "men" ? "MÃ¤nner" : "Frauen"})</h3>
        <p>Durchschnittliche Zeit: ${ref.toFixed(1)} s</p>
        <p>Ihre Zeit: <strong>${time.toFixed(1)} s</strong> â†’ ${interpretation}</p>
        <p><em>Quelle: Whitney et al., Phys Ther 2005;85(12):1289â€“1300</em></p>
      `;
      div.classList.remove("hidden");
      btn.innerText = "ğŸ“‰ Normwerte verbergen";
      normVisible = true;
    }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("5x Sit-to-Stand Test", 10, 15);
      doc.setFontSize(12);

      const time = document.getElementById("time").value;
      const age = document.getElementById("age").value;
      const sex = document.getElementById("sex").value;

      doc.text(`Zeit: ${time} Sekunden`, 10, 30);
      doc.text(`Alter: ${age}`, 10, 38);
      doc.text(`Geschlecht: ${sex === "men" ? "MÃ¤nnlich" : "Weiblich"}`, 10, 46);

      window.open(doc.output("bloburl"), "_blank");
    }
  </script>

  <!-- ZENTRALES JS -->
  <script src="app-core.js"></script>

</body>
</html>
