<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>KOOS ‚Äì Knee Injury Osteoarthritis Outcome Score</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="robotoBase64.js"></script>

  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 960px; }
    h1 { margin-bottom: .25rem; }
    .subtitle { margin-bottom: 1rem; color:#333; }
    .intro { margin: .9rem 0 1.3rem; }
    .section { margin-top: 1.7rem; }
    .qblock { margin: 1rem 0 1.3rem; }
    .qtitle { font-weight: 600; margin-bottom: .55rem; }
    .grid { width: 100%; border-collapse: collapse; margin-top: .3rem; }
    .grid th, .grid td { padding: .45rem .5rem; border: 1px solid #ccc; text-align: center; }
    .grid th:first-child, .grid td:first-child { text-align: left; white-space: nowrap; }
    button { padding: 10px 15px; margin-top: 18px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 20px; font-weight: 700; white-space: pre-line; }
  </style>
</head>

<body>

<h1>Knee Injury Osteoarthritis Outcome Score (KOOS)</h1>
<div class="subtitle">deutsche Version (Kessler et al. 2003)</div>

<p class="intro">
Der folgende Fragebogen dient der Erfassung von Beschwerden und Problemen, die durch Ihr Kniegelenk verursacht werden.
Die dadurch gewonnenen Informationen werden uns helfen einzusch√§tzen, wie es Ihnen mit Ihrem
Knie geht und wie gut Sie in der Lage sind, Ihre √ºblichen Aktivit√§ten zu verrichten.
Beantworten Sie bitte jede Frage durch Ankreuzen des zugeh√∂rigen K√§stchens.
Bitte nur ein K√§stchen pro Frage Ankreuzen. Wenn Sie sich unsicher sind, wie Sie die Frage beantworten sollen, w√§hlen Sie die Antwort aus, die Ihnen am zutreffendsten erscheint.
Bitte beantworten Sie alle Fragen gem√§√ü Ihrem aktuellen Zustand. Sollten Sie momentan keine Beschwerden haben, dann bewerten Sie die Fragen entsprechend Ihrem Zustand in der vergangenen
Woche. 

</p>

<div id="pain"     class="section"><h2>Subskala Schmerz</h2></div>
<div id="symptoms" class="section"><h2>Subskala Symptome</h2></div>
<div id="adl"      class="section"><h2>Subskala Aktivit√§ten des allt√§glichen Lebens</h2></div>
<div id="sport"    class="section"><h2>Subskala sportliche Aktivit√§ten/Freizeit</h2></div>
<div id="qol"      class="section"><h2>Subskala Lebensqualit√§t</h2></div>

<button onclick="calculate()">‚úÖ Score berechnen</button>
<button onclick="downloadPDF()">üìÑ Als PDF speichern</button>

<div id="result"></div>

<hr style="margin: 2rem 0;">

<div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
  <button onclick="goBack()" style="padding:10px 18px; border-radius:8px; border:none; background:#f0f0f0; font-size:1rem; cursor:pointer;">‚¨ÖÔ∏è Zur√ºck</button>
  <button onclick="window.location.href='index.html'" style="padding:10px 18px; border-radius:8px; border:none; background:#d0eaff; font-size:1rem; cursor:pointer;">üè† Hauptseite</button>
</div>

<script>
const SCALE_FREQ = ["niemals","selten","manchmal","oft","immer"];
const SCALE_DEG  = ["keine","schwach","m√§√üig","stark","sehr stark"];
const SCALE_DIFF = ["keine","wenig","einige","gro√üe","sehr gro√üe"];
const SCALE_LIFE = ["nicht","wenig","etwas","stark","vollst√§ndig"];
const SCALE_STAB = ["gar nicht","wenig","einiges","schlimm","sehr schlimm"];

const PAIN = [
 {id:"P1",text:"1. Wie oft tut Ihnen Ihr Knie weh?",scale:SCALE_FREQ,values:[0,1,2,3,4]},
 {id:"P2",text:"2. Schmerzen beim Drehen im Knie:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P3",text:"3. Schmerzen beim vollst√§ndigen Ausstrecken des Knies:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P4",text:"4. Schmerzen beim vollst√§ndigen Beugen des Knies:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P5",text:"5. Schmerzen beim Gehen auf ebener Fl√§che:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P6",text:"6. Schmerzen beim Treppensteigen:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P7",text:"7. Schmerzen beim Drehen im Bett:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P8",text:"8. Schmerzen beim Sitzen oder Liegen:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"P9",text:"9. Schmerzen beim Stehen:",scale:SCALE_DEG,values:[0,1,2,3,4]},
];

const SYMPTOMS = [
 {id:"S1",text:"10. Schwellungen des Knies:",scale:SCALE_FREQ,values:[0,1,2,3,4]},
 {id:"S2",text:"11. Knacken / Reiben im Knie:",scale:SCALE_FREQ,values:[0,1,2,3,4]},
 {id:"S3",text:"12. Knie bleibt h√§ngen/blockiert:",scale:SCALE_FREQ,values:[0,1,2,3,4]},
 {id:"S4",text:"13. K√∂nnen Sie Ihr Knie ganz ausstrecken?",scale:["immer","oft","manchmal","selten","niemals"],values:[4,3,2,1,0]},
 {id:"S5",text:"14. K√∂nnen Sie Ihr Knie ganz beugen?",scale:["immer","oft","manchmal","selten","niemals"],values:[4,3,2,1,0]},
 {id:"S6",text:"15. Kniesteifigkeit morgens:",scale:SCALE_DEG,values:[0,1,2,3,4]},
 {id:"S7",text:"16. Kniesteifigkeit nach Sitzen/Liegen:",scale:SCALE_DEG,values:[0,1,2,3,4]},
];

const ADL = [];
["Treppen heruntersteigen","Treppen heraufsteigen","Vom Sitzen aufstehen","Stehen",
 "B√ºcken um etwas aufzuheben","Gehen auf ebener Fl√§che","Ins Auto ein-/aussteigen",
 "Einkaufen","Str√ºmpfe/Socken anziehen","Vom Bett aufstehen","Str√ºmpfe/Socken ausziehen",
 "Im Bett drehen","In/aus der Badewanne steigen","Sitzen","Auf Toilette setzen / aufstehen",
 "Schwere Hausarbeit","Leichte Hausarbeit"
].forEach((t,i)=>ADL.push({id:`A${i+1}`,text:`${17+i}. ${t}:`,scale:SCALE_DIFF,values:[0,1,2,3,4]}));

const SPORT = [
 {id:"SP1",text:"34. Hocke:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
 {id:"SP2",text:"35. Rennen:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
 {id:"SP3",text:"36. H√ºpfen:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
 {id:"SP4",text:"37. Drehen auf belastetem Knie:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
 {id:"SP5",text:"38. Knien:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
];

const QOL = [
 {id:"Q1",text:"39. Wie oft sp√ºren Sie Ihr Knie?",scale:["nie","monatlich","w√∂chentlich","t√§glich","immer"],values:[0,1,2,3,4]},
 {id:"Q2",text:"40. Lebensweise angepasst zur Knieentlastung:",scale:SCALE_LIFE,values:[0,1,2,3,4]},
 {id:"Q3",text:"41. Belastung durch Instabilit√§t:",scale:SCALE_STAB,values:[0,1,2,3,4]},
 {id:"Q4",text:"42. Gesamte Schwierigkeiten durch das Knie:",scale:SCALE_DIFF,values:[0,1,2,3,4]},
];

function render(container, list){
  const wrap = document.getElementById(container);
  list.forEach(q=>{
    wrap.innerHTML += `
      <div class="qblock">
        <div class="qtitle">${q.text}</div>
        <table class="grid">
          <tr><th>Antwort</th>${q.scale.map(l=>`<td>${l}</td>`).join("")}</tr>
          <tr><th>Auswahl</th>${q.values.map(v=>`<td><input type="radio" name="${q.id}" value="${v}"></td>`).join("")}</tr>
        </table>
      </div>`;
  });
}

render("pain",PAIN);
render("symptoms",SYMPTOMS);
render("adl",ADL);
render("sport",SPORT);
render("qol",QOL);

function v(id){ const e=document.querySelector(`input[name="${id}"]:checked`); return e?+e.value:0; }
function mean(a){ return a.reduce((x,y)=>x+y,0)/a.length; }
function s(list){ return +(100 - mean(list.map(v))*25).toFixed(1); }

function calculate(){
  const pain = s(PAIN.map(i=>i.id));
  const symp = s(SYMPTOMS.map(i=>i.id));
  const adl  = s(ADL.map(i=>i.id));
  const sport = s(SPORT.map(i=>i.id));
  const qol = s(QOL.map(i=>i.id));
  const total = +((pain+symp+adl+sport+qol)/5).toFixed(1);

  window.koosScores = {pain,symp,adl,sport,qol,total};

  document.getElementById("result").textContent =
`KOOS Schmerz: ${pain} %
KOOS Symptome: ${symp} %
KOOS ADL: ${adl} %
KOOS Sport/Rec: ${sport} %
KOOS Lebensqualit√§t: ${qol} %

KOOS Gesamt (Mittelwert der Subskalen): ${total} %`;
}

function downloadPDF(){
  if(!window.koosScores){ 
    alert("Bitte zuerst Score berechnen."); 
    return; 
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({unit:"mm", format:"a4"});

  if(window.robotoBase64){
    doc.addFileToVFS("Roboto-Regular.ttf", window.robotoBase64);
    doc.addFont("Roboto-Regular.ttf","Roboto","normal");
    doc.setFont("Roboto");
  }

  // Datum
  const today = new Date().toLocaleDateString("de-CH", {
    year: "numeric", month: "2-digit", day: "2-digit"
  });

  let y=20, left=15, lh=7;

  // HEADER
  doc.setFontSize(16);
  doc.text("KOOS ‚Äì Auswertung", left, y); 
  y+=lh;
  doc.setFontSize(11);
  doc.text(`Datum: ${today}`, left, y);
  y+=lh+2;

  function block(title, items){
    doc.setFontSize(13); 
    doc.text(title, left, y); 
    y+=lh;
    doc.setFontSize(11);

    items.forEach(q=>{
      const sel = document.querySelector(`input[name="${q.id}"]:checked`);
      const label = sel ? q.scale[q.values.indexOf(+sel.value)] : "-";
      const textLines = doc.splitTextToSize(q.text, 170);

      textLines.forEach((l,i)=>{
        doc.text(l, left, y);
        if(i===0) doc.text(label, 195, y, {align:"right"});
        y+=lh;
      });
      y+=2;

      if(y>275){
        doc.addPage();
        y=20;
      }
    });
    y+=4;
    if(y>275){
      doc.addPage();
      y=20;
    }
  }

  block("Schmerz", PAIN);
  block("Symptome", SYMPTOMS);
  block("ADL", ADL);
  block("Sport/Freizeit", SPORT);
  block("Lebensqualit√§t", QOL);

  if(y>260){ doc.addPage(); y=20; }

  doc.setFontSize(13);
  doc.text("Ergebnisse:", left, y); 
  y+=lh;
  doc.setFontSize(11);

  doc.text(`KOOS Schmerz: ${window.koosScores.pain} %`, left, y); y+=lh;
  doc.text(`KOOS Symptome: ${window.koosScores.symp} %`, left, y); y+=lh;
  doc.text(`KOOS ADL: ${window.koosScores.adl} %`, left, y); y+=lh;
  doc.text(`KOOS Sport/Rec: ${window.koosScores.sport} %`, left, y); y+=lh;
  doc.text(`KOOS Lebensqualit√§t: ${window.koosScores.qol} %`, left, y); y+=lh+2;

  doc.setLineWidth(0.2);
  doc.line(left, y, 195, y); 
  y+=lh;

  doc.setFontSize(13);
  doc.text(`KOOS Gesamt (Mittelwert): ${window.koosScores.total} %`, left, y);

  doc.save("KOOS_Auswertung.pdf");
}

<div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
  <!-- Zur√ºck zur letzten Seite -->
  <button onclick="goBack()" style="
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    background-color: #f0f0f0;
    font-size: 1rem;
    cursor: pointer;
  ">
    ‚¨ÖÔ∏è Zur√ºck
  </button>

  <!-- Zur√ºck zur Hauptseite -->
  <button onclick="window.location.href='index.html'" style="
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    background-color: #d0eaff;
    font-size: 1rem;
    cursor: pointer;
  ">
    üè† Hauptseite
  </button>
</div>

<script>
function goBack() {
  // Pr√ºft, ob es eine vorherige Seite gibt
  if (document.referrer && document.referrer !== window.location.href) {
    history.back();
  } else {
    // Falls keine History vorhanden ‚Üí zur Startseite
    window.location.href = 'index.html';
  }
}
</script>


</body>
</html>
