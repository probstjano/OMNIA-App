<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ACL-RSI ‚Äì Return to Sports</title>

  <!-- zentrale Dateien -->
  <link rel="stylesheet" href="app-style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="robotoBase64.js"></script>

  <style>
    .question-block {
      margin: 25px 0;
      padding-bottom: 10px;
      border-bottom: 1px solid #ccc;
    }

    .scale-container {
      width: 100%;
      overflow-x: auto;
      margin-top: 12px;
    }

    table.scale-table {
      width: 100%;
      min-width: 650px;
      border-collapse: collapse;
      text-align: center;
      margin-bottom: 5px;
    }

    table.scale-table td {
      padding: 6px;
      border: 1px solid #ccc;
      width: 50px;
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      margin-top: 4px;
      font-weight: bold;
    }
  </style>
</head>

<body class="assessment-page">

<h1>ACL-RSI-Skala (Return to Sports)</h1>

<p>
Dieser Fragebogen dient der Erfassung von Beschwerden und Problemen, die durch Ihr Kniegelenk verursacht werden. 
Beantworten Sie die folgenden Fragen zu der Sportart, die Sie als Hauptsportart vor Ihrer Verletzung ausge√ºbt haben. 
Kreuzen Sie dasjenige K√§stchen an, das Ihr derzeitiges Befinden am besten wiedergibt.
</p>

<p><strong>Hauptsportart:</strong></p>
<input type="text" style="width:100%;">

<form id="aclForm">

<div id="questions"></div>

</form>

<button type="button" class="primary" onclick="calcACL()">‚úÖ Score berechnen</button>
<button type="button" class="secondary" onclick="pdfACL()">üìÑ PDF erstellen</button>

<div id="result" style="margin-top:20px;"></div>

<script>

const qTexts = [
"1. Sind Sie zuversichtlich, dass Sie den Sport auf demselben Niveau wie vorher aus√ºben k√∂nnen?",
"2. Halten Sie es f√ºr wahrscheinlich, Ihr Knie durch die Teilnahme an Ihrem Sport wieder verletzen zu k√∂nnen?",
"3. Macht Sie der Gedanke an die Aus√ºbung Ihres Sports nerv√∂s?",
"4. Sind Sie zuversichtlich, dass Ihr Knie bei der Aus√ºbung Ihres Sports nicht nachgeben wird?",
"5. Sind Sie zuversichtlich, dass Sie Ihren Sport aus√ºben k√∂nnen, ohne Bedenken wegen Ihres Knies zu haben?",
"6. Finden Sie es frustrierend, dass Sie in Bezug auf Ihren Sport Ihr Knie ber√ºcksichtigen m√ºssen?",
"7. Bef√ºrchten Sie, dass Sie Ihr Knie bei der Aus√ºbung Ihres Sports wieder verletzen k√∂nnten?",
"8. Sind Sie zuversichtlich, dass Ihr Knie unter Belastung standh√§lt?",
"9. Haben Sie Angst, dass Sie Ihr Knie bei der Aus√ºbung Ihres Sports versehentlich wieder verletzen k√∂nnten?",
"10. H√§lt Sie der Gedanke daran, nochmals operiert und nachbehandelt werden zu m√ºssen, davon ab, Ihren Sport auszu√ºben?",
"11. Sind Sie zuversichtlich, Ihren Sport gut aus√ºben zu k√∂nnen?",
"12. Sind Sie gelassen, wenn es um die Aus√ºbung Ihres Sports geht?"
];

const container = document.getElementById("questions");

function buildScale(name) {
  const values = [0,10,20,30,40,50,60,70,80,90,100];

  let html = `
  <div class="scale-container">
    <table class="scale-table">
      <tr>
        ${values.map(v => `<td>${v}</td>`).join("")}
      </tr>
      <tr>
        ${values.map(v => `<td><input type="radio" name="${name}" value="${v}"></td>`).join("")}
      </tr>
    </table>
  </div>
  `;

  return html;
}

qTexts.forEach((q, i) => {
  const nr = i+1;

  const block = document.createElement("div");
  block.className = "question-block";

  block.innerHTML = `
    <p><strong>${q}</strong></p>
    ${buildScale("q" + nr)}
  `;

  container.appendChild(block);
});


function calcACL() {
  let sum = 0;

  for (let i = 1; i <= 12; i++) {
    const el = document.querySelector(`input[name='q${i}']:checked`);
    if (!el) {
      document.getElementById("result").innerHTML = "<p>Bitte alle 12 Fragen beantworten.</p>";
      return;
    }
    sum += parseInt(el.value);
  }

  const score = ((sum / 1200) * 100).toFixed(1);

  document.getElementById("result").innerHTML = `
    <p><strong>ACL-RSI-Score:</strong> ${score}%</p>
    <p>(( ${sum} ) erreichte Punkte) / (1200 maximale Punkte) √ó 100 = ${score}%</p>
  `;
}


function pdfACL() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.addFileToVFS("Roboto-Regular.ttf", window.robotoBase64);
  doc.addFont("Roboto-Regular.ttf", "Roboto", "normal");
  doc.setFont("Roboto");
  doc.setFontSize(12);

  let y = 15;
  const lh = 8;

  doc.setFontSize(16);
  doc.text("ACL-RSI ‚Äì Return to Sports", 15, y);
  y += 14;
  doc.setFontSize(12);

  for (let i = 1; i <= 12; i++) {
    const el = document.querySelector(`input[name='q${i}']:checked`);
    const val = el ? el.value : "-";

    doc.text(qTexts[i-1], 15, y);
    y += lh;
    doc.text("Wert: " + val, 15, y);
    y += lh + 2;

    if (y > 260) { doc.addPage(); y = 20; }
  }

  y += 8;

  const lines = document.getElementById("result").innerText.split("\n");
  lines.forEach(line => {
    doc.text(line, 15, y);
    y += lh;
    if (y > 270) { doc.addPage(); y = 20; }
  });

  doc.save("ACL-RSI.pdf");
}

</script>

<!-- FOOTER -->
<div class="footer-nav">
  <button class="secondary" onclick="goBack()">‚¨ÖÔ∏è Zur√ºck</button>
  <button class="primary" onclick="goHome()">üè† Hauptseite</button>
</div>

<script src="app-core.js"></script>

</body>
</html>
