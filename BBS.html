<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BBS - Berg Balance Scale </title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="robotoBase64.js"></script>
  <style>
    body { font-family: sans-serif; margin: 10px; font-size: 16px; max-width: 600px; }
    label { display: block; margin: 10px 0 5px; }
    select {
      width: 100%;
      padding: 6px;
      font-size: 16px;
      margin-bottom: 10px;
    }
    button { padding: 10px 15px; font-size: 16px; margin-top: 10px; }
    #result { font-weight: bold; margin-top: 20px; }
    .nav-buttons { margin-top: 30px; }
    .nav-buttons a {
      display: inline-block;
      margin-right: 10px;
      padding: 10px 15px;
      background: #eee;
      border-radius: 8px;
      text-decoration: none;
      color: #000;
    }
    .nav-buttons a:hover { background: #ddd; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Berg Balance Skala (BBS)</h1>
  <p>Einer der am umfassendsten untersuchten Assessments fÃ¼r das Gleichgewicht mit guter Psychometrischer GÃ¼te und ReliabilitÃ¤t. Geriatrie, MS, CVI, Parkinson.</p>
  <p>Auch in einer verkÃ¼rzten Version mÃ¶glich. Diese ist schneller, benÃ¶tigt weniger Material, ist aber weniger gut untersucht und bietet keine Norm- oder Cut-Off-Werte.</p>
  <p>Im Cenplex Behandlungsplan als <strong>Messung</strong> hinterlegt. Hier durchfÃ¼hren und Summenscore Ã¼bertragen.</p>

  <p>AusfÃ¼hrliches Protokoll hier: <a href="https://probstjano.github.io/OpenPdf/BBS_Protokoll.pdf" target="_blank" rel="noopener">BBS Protokoll (PDF)</a></p>

  <button type="button" id="toggleBtn" onclick="toggleForm()">ğŸ‘‰ Zur Kurzversion (7 Items) wechseln</button>

  <form id="bbsForm">
    <div id="questions"></div>
    <button type="button" onclick="calculateBBS()">âœ… Score berechnen</button>
    <div id="scoreDisplay"></div>

    <div id="normBlock">
      <label for="age">Alter der getesteten Person:</label>
      <input type="number" id="age" value="70" min="0" max="120" />
      <button type="button" id="normToggleBtn" onclick="toggleNorm()">ğŸ“Š Normwerte / Cut-Offs anzeigen</button>
    </div>

    <button type="button" onclick="generatePDF()">ğŸ“„ PDF erstellen</button>
  </form>

  <div id="result"></div>
  <div id="normInfo"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const fullQuestions = [
      { text: "Vom Sitzen zum Stehen", options: [
        "4 â€“ kann aufstehen ohne die HÃ¤nde einzusetzen und sich selbststÃ¤ndig stabilisieren",
        "3 â€“ kann selbststÃ¤ndig mit Einsatz der HÃ¤nde aufstehen",
        "2 â€“ kann nach einigen Versuchen mit Einsatz der HÃ¤nde aufstehen",
        "1 â€“ braucht minimale Hilfe zum Aufstehen oder zum Stabilisieren",
        "0 â€“ braucht mÃ¤ÃŸige bis maximale Hilfe um aufzustehen"
      ]},
      { text: "Stehen ohne UnterstÃ¼tzung", options: [
        "4 â€“ kann zwei Minuten sicher stehen",
        "3 â€“ kann zwei Minuten unter Supervision stehen",
        "2 â€“ kann 30 Sek. ohne UnterstÃ¼tzung stehen",
        "1 â€“ braucht einige Versuche, um 30 Sekunden ohne UnterstÃ¼tzung zu stehen",
        "0 â€“ kann nicht ohne UnterstÃ¼tzung 30 Sekunden stehen"
      ]},
      { text: "Sitzen ohne UnterstÃ¼tzung", options: [
        "4 â€“ kann sicher und stabil zwei Minuten sitzen",
        "3 â€“ kann zwei Minuten unter Supervision sitzen",
        "2 â€“ kann 30 Sekunden sitzen",
        "1 â€“ kann 10 Sekunden sitzen",
        "0 â€“ kann nicht ohne UnterstÃ¼tzung 10 Sekunden sitzen"
      ]},
      { text: "Vom Stehen zum Sitzen", options: [
        "4 â€“ setzt sich sicher mit minimalem Einsatz der HÃ¤nde hin",
        "3 â€“ kontrolliert das Hinsetzen mit den HÃ¤nden",
        "2 â€“ berÃ¼hrt mit RÃ¼ckseite der Beine den Stuhl, um das Hinsetzen zu kontrollieren",
        "1 â€“ setzt sich selbstÃ¤ndig aber unkontrolliert hin",
        "0 â€“ braucht Hilfe um sich hinzusetzen"
      ]},
      { text: "Transfers von Sitz zu Sitz", options: [
        "4 â€“ sicher mit minimalem Einsatz der HÃ¤nde",
        "3 â€“ sicher, aber mit Einsatz der HÃ¤nde",
        "2 â€“ mit Anweisung und/oder Supervision",
        "1 â€“ mit Hilfe einer Person",
        "0 â€“ mit zwei Personen oder stÃ¤ndiger UnterstÃ¼tzung"
      ]},
      { text: "Stehen mit geschlossenen Augen", options: [
        "4 â€“ zehn Sekunden sicher",
        "3 â€“ zehn Sekunden unter Supervision",
        "2 â€“ drei Sekunden",
        "1 â€“ steht stabil, aber nicht mit geschlossenen Augen",
        "0 â€“ braucht Hilfe"
      ]},
      { text: "Stehen mit FÃ¼ÃŸen dicht zusammen (enger Fussstand)", options: [
        "4 â€“ kann sst. FÃ¼sse nebeneinander stellen und 1 Minute sicher",
        "3 â€“ kann sst. FÃ¼sse nebeneinander stellen 1 Minute unter Supervision",
        "2 â€“ kann sst. FÃ¼sse nebeneinander stellen und 30 Sekunden",
        "1 â€“ Hilfe um FÃ¼sse nebeneinander zus tellen, kann aber 15 Sekunden stehen",
        "0 â€“ nicht mÃ¶glich"
      ]},
      { text: "Mit ausgestrecktem Arm nach vorne reichen/greifen", options: [
        "4 â€“ mehr als 25 cm",
        "3 â€“ mehr als 12.5 cm",
        "2 â€“ mehr als 5 cm",
        "1 â€“ weniger als 5 cm oder Supervision",
        "0 â€“ Gleichgewichtsverlust, Hilfe nÃ¶tig"
      ]},
      { text: "Gegenstand (Schuh) vom Boden aufheben", options: [
        "4 â€“ sicher und mit Leichtigkeit",
        "3 â€“ mit Supervision",
        "2 â€“ kann nicht sst. reicht aber bis auf 2-5cm an den Schuh heran und hÃ¤llt sst. GGW",
        "1 â€“ nicht mÃ¶glich, und benÃ¶tigt UnterstÃ¼tzung beim Versuch",
        "0 â€“ nicht mÃ¶glich, Gleichgewichtsverlust/benÃ¶tigt Hilfe um nicht zu fallen"
      ]},
      { text: "Sich umdrehen und nach hinten schauen", options: [
        "4 â€“ sicher nach beiden Seiten",
        "3 â€“ schaut nur Ã¼ber eine Seite nach hinten, und zeigt weniger Gewichtsverlagerung auf der anderen Seite",
        "2 â€“ dreht sich nur zur Seite aber bewahrt das Gleichgewicht",
        "1 â€“ braucht Supervision beim Umdrehen",
        "0 â€“ braucht Hilfe um das Gleichgewicht nicht zu verlieren bzw. nicht zu fallen"
      ]},
      { text: "Sich um 360Â° drehen in beide Richtungen", options: [
        "4 â€“ sicher in < 4 Sekunden in beide Richtungen",
        "3 â€“ sicher in 4 Sekunden aber nur eine Richtung",
        "2 â€“ mÃ¶glich aber langsam",
        "1 â€“ braucht nahe Supervision oder verbale Hilfestellung",
        "0 â€“ braucht Hilfe beim Drehen/nicht mÃ¶glich"
      ]},
      { text: "Abwechselnd die FÃ¼sse auf eine Fussbank stellen (4x/Seite)", options: [
        "4 â€“ sicher und kontrolliert innerhalb 20s ",
        "3 â€“ kann sicher und selbstÃ¤ndig stehen und in mehr als 20 Sekunden die acht Schrittfolgen/Stufen absolvieren ",
        "2 â€“ kann vier Schrittfolgen/Stufen ohne Hilfe unter Supervision ",
        "1 â€“ kann mehr als zwei Stufen/Schrittfolgen mit minimaler Hilfe absolvieren ",
        "0 â€“ braucht Hilfe um nicht zu fallen/ schon der Versuch scheitert "
      ]},
      { text: "Tandemstand", options: [
        "4 â€“ kann selbstÃ¤ndig die FÃ¼ÃŸe in den Tandemstand bringen und 30 Sekunden halten",
        "3 â€“ kann selbstÃ¤ndig einen FuÃŸ vor den anderen stellen und diese Position 30 Sekunden halten ",
        "2 â€“ kann selbstÃ¤ndig einen kleinen Schritt nach vorne machen und diese Position 30 Sekunden halten",
        "1 â€“ braucht Hilfe fÃ¼r den Schritt, kann aber Position 15 Sekunden beibehalten",
        "0 â€“ verliert Gleichgewicht wÃ¤hrend des Schritts oder des Stehens"
      ]},
      { text: "Einbeinstand", options: [
        "4 â€“ 10 Sekunden sicher",
        "3 â€“ 5-10s",
        "2 â€“ 3 Sekunden",
        "1 â€“ versucht ein Bein anzuheben, kann Position nicht drei Sekunden lang beibe halten, bleibt aber selbstÃ¤ndig stehen ",
        "0 â€“ schon der Versuch scheitert oder Proband braucht Hilfe, um nicht zu fallen"
      ]}
    ];

    const shortIndexes = [0, 5, 7, 8, 9, 12, 13];
    let useShort = false;
    let currentScore = null;
    let normVisible = false;

    function toggleForm() {
      useShort = !useShort;
      document.getElementById("toggleBtn").innerText = useShort
        ? "ğŸ” Zur Vollversion (14 Items) wechseln"
        : "ğŸ‘‰ Zur Kurzversion (7 Items) wechseln";
      renderForm();
      document.getElementById("scoreDisplay").innerText = "";
      document.getElementById("result").innerText = "";
      document.getElementById("normInfo").innerText = "";
      document.getElementById("normBlock").style.display = "none";
      normVisible = false;
    }

    function renderForm() {
      const container = document.getElementById("questions");
      container.innerHTML = "";
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;
      items.forEach((q, i) => {
        const fullIndex = useShort ? shortIndexes[i] : i;
        const block = document.createElement("div");
        block.className = "question-block";
        const options = q.options.map((textOpt, idx) =>
          `<option value="${4 - idx}">${textOpt}</option>`).join("");
        block.innerHTML = `
          <div class="question">${fullIndex + 1}. ${q.text}</div>
          <select name="q${fullIndex}" required>
            <option value="" disabled selected>Antwort auswÃ¤hlen</option>
            ${options}
          </select>
        `;
        container.appendChild(block);
      });
    }

    function calculateNorm(age) {
      if (age < 70) return 56;
      return Math.round((56 - ((age - 70) * 0.7)) * 10) / 10;
    }

    function calculateBBS() {
      const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;
      let total = 0;
      for (let idx = 0; idx < items.length; idx++) {
        const fullIndex = useShort ? shortIndexes[idx] : idx;
        const sel = document.querySelector(`select[name='q${fullIndex}']`);
        if (!sel || sel.value === "") return alert("Bitte alle Fragen beantworten.");
        total += parseInt(sel.value);
      }
      const max = useShort ? 28 : 56;
      currentScore = total;
      document.getElementById("scoreDisplay").innerText = `BBS Gesamtscore: ${total} / ${max}`;
      if (!useShort) document.getElementById("normBlock").style.display = "block";
    }

    function toggleNorm() {
      const normBtn = document.getElementById("normToggleBtn");
      if (!normVisible) {
        const age = parseInt(document.getElementById("age").value);
        const norm = calculateNorm(age);
        document.getElementById("result").innerText = 
          `Erwarteter Normwert (Alter ${age}): ${norm} Punkte\nCut-off fÃ¼r erhÃ¶htes Sturzrisiko: < 45 Punkte. (BBS aber nicht empfohlen zur alleinigen Beurteilung des Sturzrisikos)`;
        document.getElementById("normInfo").innerText =
          "Ein 70-jÃ¤hriger, selbststÃ¤ndig lebender Mensch ohne beeintrÃ¤chtigende Erkrankungen erreicht wahrscheinlich einen Maximalwert von 56 Punkten auf der BBS. Mit jedem Lebensjahr mehr nimmt der mittlere Wert um ca. 0,7 Punkte pro Jahr ab und die Streuung der Werte steigt deutlich an.";
        normBtn.innerText = "âŒ Normwerte verbergen";
        normVisible = true;
      } else {
        document.getElementById("result").innerText = "";
        document.getElementById("normInfo").innerText = "";
        normBtn.innerText = "ğŸ“Š Normwerte / Cut-Offs anzeigen";
        normVisible = false;
      }
    }

    
async function generatePDF() {
  if (currentScore === null) {
    alert("Bitte zuerst auf 'Score berechnen' klicken.");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.addFileToVFS("Roboto-Regular.ttf", window.robotoBase64);
  doc.addFont("Roboto-Regular.ttf", "Roboto", "normal");
  doc.setFont("Roboto", "normal");

  const left = 15;
  const right = 190;
  const lineHeight = 8;
  let y = 15;
  let questionNumber = 1;

  doc.setFontSize(16);
  doc.text("Berg Balance Scale (BBS) â€“ Auswertung", left, y);
  y += lineHeight;

  doc.setFontSize(12);
  doc.line(left, y, right, y);
  y += 5;

  const items = useShort ? shortIndexes.map(i => fullQuestions[i]) : fullQuestions;

  for (let idx = 0; idx < items.length; idx++) {
    const fullIndex = useShort ? shortIndexes[idx] : idx;
    const sel = document.querySelector(`select[name='q${fullIndex}']`);
    if (!sel || sel.value === "") continue;

    const val = parseInt(sel.value);
    const rawText = items[idx].text;
    const fullLine = `${questionNumber}. ${rawText}`;
    const wrapped = doc.splitTextToSize(fullLine, 160);

    wrapped.forEach((line, i) => {
      doc.text(line, left, y);
      if (i === 0) {
        doc.text(`${val}`, right, y, { align: "right" });
      }
      y += lineHeight;
    });

    y += 2;
    questionNumber++;

    if (y > 270) {
      doc.addPage();
      y = 20;
    }
  }

  const max = useShort ? 28 : 56;
  const today = new Date().toLocaleDateString("de-CH");

  y += 5;
  doc.setFontSize(13);
  doc.setFont(undefined, "bold");
  doc.text("Gesamtergebnis:", left, y); y += lineHeight;

  doc.setFont(undefined, "normal");
  doc.setFontSize(12);
  doc.text(`Gesamtscore: ${currentScore} / ${max}`, left, y); y += lineHeight;
  doc.text(`Datum: ${today}`, left, y);

  doc.save("BBS_Auswertung.pdf");
}
    renderForm();
  </script>

<div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
  <!-- ZurÃ¼ck zur letzten Seite -->
  <button onclick="goBack()" style="
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    background-color: #f0f0f0;
    font-size: 1rem;
    cursor: pointer;
  ">
    â¬…ï¸ ZurÃ¼ck
  </button>

  <!-- ZurÃ¼ck zur Hauptseite -->
  <button onclick="window.location.href='index.html'" style="
    padding: 10px 18px;
    border-radius: 8px;
    border: none;
    background-color: #d0eaff;
    font-size: 1rem;
    cursor: pointer;
  ">
    ğŸ  Hauptseite
  </button>
</div>

<script>
function goBack() {
  // PrÃ¼ft, ob es eine vorherige Seite gibt
  if (document.referrer && document.referrer !== window.location.href) {
    history.back();
  } else {
    // Falls keine History vorhanden â†’ zur Startseite
    window.location.href = 'index.html';
  }
}
</script>

  
</body>
</html>
