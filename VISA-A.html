<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VISA-A</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Roboto optional wie in deinen anderen Dateien -->
  <script src="robotoBase64.js"></script>
  <style>
    body { font-family: sans-serif; margin: 2rem; font-size: 16px; max-width: 920px; }
    h1 { margin-bottom: .25rem; }
    .subtitle { color: #333; margin-bottom: 1rem; }
    .intro { margin: .75rem 0 1.25rem; }
    .qblock { margin: 1.1rem 0 1.2rem; }
    .qtitle { font-weight: 700; margin-bottom: .5rem; }
    .scale-line { font-style: italic; margin: .25rem 0 .5rem; display:flex; justify-content:space-between; }
    .label-min { white-space: nowrap; }
    .label-max { white-space: nowrap; text-align:right; }
    .grid { width: 100%; border-collapse: collapse; margin-top: .2rem; }
    .grid th, .grid td { padding: .35rem .4rem; border: 1px solid #ddd; text-align: center; }
    .grid th:first-child, .grid td:first-child { text-align: left; white-space: nowrap; }
    .grid .muted { color:#666; font-weight: normal; }
    .opts-row { display:flex; gap: 10px; flex-wrap: wrap; margin-top: .4rem; }
    .opts-row label { display:flex; gap:.4rem; align-items:center; }
    .hint { font-size: 0.95rem; margin:.35rem 0 .4rem; }
    button { padding: 10px 15px; font-size: 16px; cursor: pointer; }
    #result { margin-top: 18px; font-weight: 700; white-space: pre-line; }
    .hr { border:0; border-top:1px solid #ddd; margin: 1rem 0; }
    .footnote { font-size: .92rem; color:#444; }
  </style>
</head>
<body>
  <h1>VISA-A</h1>
  <div class="subtitle">validierte deutsche Version (Lohrer et al. 2011)</div>

  <p class="intro">
    Sehr geehrter Patient, der folgende Fragebogen dient der Erfassung von Beschwerden und Problemen, die durch Ihre Achillessehne verursacht werden. 
    <br/>Kreuzen Sie für jede Frage dasjenige Kästchen an, das Ihr derzeitiges Befinden wiedergibt. :contentReference[oaicite:1]{index=1}
  </p>

  <form id="form">
    <!-- 1 -->
    <div class="qblock" id="q1">
      <div class="qtitle">1. Für wie viele Minuten verspüren Sie nach dem ersten Aufstehen ein Steifigkeitsgefühl in der Achillessehnenregion?</div>
      <table class="grid">
        <tr>
          <th>Minuten</th>
          <td>100</td><td>90</td><td>80</td><td>70</td><td>60</td><td>50</td><td>40</td><td>30</td><td>20</td><td>10</td><td>0</td>
        </tr>
        <tr>
          <th>Punkte</th>
          <td><input type="radio" name="q1" value="0"></td>
          <td><input type="radio" name="q1" value="1"></td>
          <td><input type="radio" name="q1" value="2"></td>
          <td><input type="radio" name="q1" value="3"></td>
          <td><input type="radio" name="q1" value="4"></td>
          <td><input type="radio" name="q1" value="5"></td>
          <td><input type="radio" name="q1" value="6"></td>
          <td><input type="radio" name="q1" value="7"></td>
          <td><input type="radio" name="q1" value="8"></td>
          <td><input type="radio" name="q1" value="9"></td>
          <td><input type="radio" name="q1" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 2 -->
    <div class="qblock" id="q2">
      <div class="qtitle">2. Nachdem Sie für den Tag aufgewärmt sind, haben Sie Schmerzen, wenn Sie die Achillessehne über der Kante einer Treppe dehnen (Knie gestreckt halten)?</div>
      <div class="scale-line">
        <span class="label-min">Schmerz – Starker heftiger Schmerz</span>
        <span class="label-max">Kein Schmerz</span>
      </div>
      <table class="grid">
        <tr>
          <th>Punkte</th>
          <td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
        </tr>
        <tr>
          <th class="muted">Auswahl</th>
          <td><input type="radio" name="q2" value="0"></td>
          <td><input type="radio" name="q2" value="1"></td>
          <td><input type="radio" name="q2" value="2"></td>
          <td><input type="radio" name="q2" value="3"></td>
          <td><input type="radio" name="q2" value="4"></td>
          <td><input type="radio" name="q2" value="5"></td>
          <td><input type="radio" name="q2" value="6"></td>
          <td><input type="radio" name="q2" value="7"></td>
          <td><input type="radio" name="q2" value="8"></td>
          <td><input type="radio" name="q2" value="9"></td>
          <td><input type="radio" name="q2" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 3 -->
    <div class="qblock" id="q3">
      <div class="qtitle">3. Nachdem Sie 30 Minuten auf unebenem Untergrund gegangen sind, haben Sie in den darauffolgenden 2 Stunden Schmerzen? (Wenn Sie wegen Schmerzen nicht auf unebenem Untergrund 30 Minuten gehen können, kreuzen Sie bei dieser Frage 0 an).</div>
      <div class="scale-line">
        <span class="label-min">Schmerz – Starker heftiger Schmerz</span>
        <span class="label-max">Kein Schmerz</span>
      </div>
      <table class="grid">
        <tr>
          <th>Punkte</th>
          <td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
        </tr>
        <tr>
          <th class="muted">Auswahl</th>
          <td><input type="radio" name="q3" value="0"></td>
          <td><input type="radio" name="q3" value="1"></td>
          <td><input type="radio" name="q3" value="2"></td>
          <td><input type="radio" name="q3" value="3"></td>
          <td><input type="radio" name="q3" value="4"></td>
          <td><input type="radio" name="q3" value="5"></td>
          <td><input type="radio" name="q3" value="6"></td>
          <td><input type="radio" name="q3" value="7"></td>
          <td><input type="radio" name="q3" value="8"></td>
          <td><input type="radio" name="q3" value="9"></td>
          <td><input type="radio" name="q3" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 4 -->
    <div class="qblock" id="q4">
      <div class="qtitle">4. Haben Sie Schmerzen, wenn Sie mit normaler Geschwindigkeit die Treppe heruntergehen?</div>
      <div class="scale-line">
        <span class="label-min">Schmerz – Starker heftiger Schmerz</span>
        <span class="label-max">Kein Schmerz</span>
      </div>
      <table class="grid">
        <tr>
          <th>Punkte</th>
          <td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
        </tr>
        <tr>
          <th class="muted">Auswahl</th>
          <td><input type="radio" name="q4" value="0"></td>
          <td><input type="radio" name="q4" value="1"></td>
          <td><input type="radio" name="q4" value="2"></td>
          <td><input type="radio" name="q4" value="3"></td>
          <td><input type="radio" name="q4" value="4"></td>
          <td><input type="radio" name="q4" value="5"></td>
          <td><input type="radio" name="q4" value="6"></td>
          <td><input type="radio" name="q4" value="7"></td>
          <td><input type="radio" name="q4" value="8"></td>
          <td><input type="radio" name="q4" value="9"></td>
          <td><input type="radio" name="q4" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 5 -->
    <div class="qblock" id="q5">
      <div class="qtitle">5. Haben Sie Schmerzen, während oder unmittelbar nachdem Sie 10 (einbeinige) Zehenstände auf einer flachen Unterlage ausgeführt haben?</div>
      <div class="scale-line">
        <span class="label-min">Schmerz – Starker heftiger Schmerz</span>
        <span class="label-max">Kein Schmerz</span>
      </div>
      <table class="grid">
        <tr>
          <th>Punkte</th>
          <td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td>
        </tr>
        <tr>
          <th class="muted">Auswahl</th>
          <td><input type="radio" name="q5" value="0"></td>
          <td><input type="radio" name="q5" value="1"></td>
          <td><input type="radio" name="q5" value="2"></td>
          <td><input type="radio" name="q5" value="3"></td>
          <td><input type="radio" name="q5" value="4"></td>
          <td><input type="radio" name="q5" value="5"></td>
          <td><input type="radio" name="q5" value="6"></td>
          <td><input type="radio" name="q5" value="7"></td>
          <td><input type="radio" name="q5" value="8"></td>
          <td><input type="radio" name="q5" value="9"></td>
          <td><input type="radio" name="q5" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 6 -->
    <div class="qblock" id="q6">
      <div class="qtitle">6. Wie oft können Sie ohne Schmerzen auf einem Bein hüpfen?</div>
      <table class="grid">
        <tr>
          <th>Sprünge</th>
          <td>0x</td><td>1x</td><td>2x</td><td>3x</td><td>4x</td><td>5x</td><td>6x</td><td>7x</td><td>8x</td><td>9x</td><td>10x</td>
        </tr>
        <tr>
          <th>Punkte</th>
          <td><input type="radio" name="q6" value="0"></td>
          <td><input type="radio" name="q6" value="1"></td>
          <td><input type="radio" name="q6" value="2"></td>
          <td><input type="radio" name="q6" value="3"></td>
          <td><input type="radio" name="q6" value="4"></td>
          <td><input type="radio" name="q6" value="5"></td>
          <td><input type="radio" name="q6" value="6"></td>
          <td><input type="radio" name="q6" value="7"></td>
          <td><input type="radio" name="q6" value="8"></td>
          <td><input type="radio" name="q6" value="9"></td>
          <td><input type="radio" name="q6" value="10"></td>
        </tr>
      </table>
    </div>

    <!-- 7 -->
    <div class="qblock" id="q7">
      <div class="qtitle">7. Üben Sie derzeit Sport oder andere körperliche Aktivitäten aus?</div>
      <div class="opts-row">
        <label><input type="radio" name="q7" value="0"> Nein, gar nicht; wegen der Achillessehnensymptome (0)</label>
        <label><input type="radio" name="q7" value="4"> Verändertes Trainings- und/oder Wettkampfverhalten, verglichen mit dem Zustand vor Beginn der Symptome (4)</label>
        <label><input type="radio" name="q7" value="7"> Volle Trainings- und/oder Wettkampfbelastung, aber nicht auf dem gleichen Niveau wie vor Beginn der Symptome (7)</label>
        <label><input type="radio" name="q7" value="10"> Voll belastbar oder Trainings- und/oder Wettkampfbelastung auf dem gleichen oder auf höherem Niveau als vor Beginn der Symptome (10)</label>
      </div>
    </div>

    <hr class="hr"/>

    <!-- 8 Hinweistext -->
    <div class="qblock" id="q8-info">
      <div class="qtitle">8. Bitte beantworten Sie entweder A, B oder C dieser Frage.</div>
      <div class="footnote">
        • Wenn Sie bei der Durchführung achillessehnenbelastender Sportarten keine Schmerzen empfinden, füllen Sie bitte nur Frage 8a aus.
        <br/>• Wenn Sie bei der Durchführung achillessehnenbelastender Sportarten Schmerzen empfinden, die Sie aber nicht zum Belastungsabbruch der Aktivität zwingen, füllen Sie bitte nur Frage 8b aus.
        <br/>• Wenn Sie bei der Durchführung achillessehnenbelastender Sportarten Schmerzen empfinden, die Sie zum Abbruch der Aktivität zwingen, füllen Sie bitte nur Frage 8c aus. :contentReference[oaicite:2]{index=2}
      </div>
    </div>

    <!-- 8a -->
    <div class="qblock" id="q8a">
      <div class="qtitle">8a. Wie lange können Sie trainieren/üben, wenn Sie bei der Durchführung achillessehnenbelastender Sportarten keine Schmerzen empfinden?</div>
      <table class="grid">
        <tr><th>Minuten</th><td>0</td><td>1-10</td><td>11-20</td><td>21-30</td><td>&gt;30</td></tr>
        <tr>
          <th>Punkte</th>
          <td><input type="radio" name="q8a" value="0"></td>
          <td><input type="radio" name="q8a" value="7"></td>
          <td><input type="radio" name="q8a" value="14"></td>
          <td><input type="radio" name="q8a" value="21"></td>
          <td><input type="radio" name="q8a" value="30"></td>
        </tr>
      </table>
    </div>

    <!-- 8b -->
    <div class="qblock" id="q8b">
      <div class="qtitle">8b. Wie lange können Sie trainieren/üben, wenn Sie bei der Durchführung achillessehnenbelastender Sportarten Schmerzen empfinden, die Sie aber nicht zum Belastungsabbruch der Aktivität zwingen?</div>
      <table class="grid">
        <tr><th>Minuten</th><td>0</td><td>1-10</td><td>11-20</td><td>21-30</td><td>&gt;30</td></tr>
        <tr>
          <th>Punkte</th>
          <td><input type="radio" name="q8b" value="0"></td>
          <td><input type="radio" name="q8b" value="4"></td>
          <td><input type="radio" name="q8b" value="10"></td>
          <td><input type="radio" name="q8b" value="14"></td>
          <td><input type="radio" name="q8b" value="20"></td>
        </tr>
      </table>
    </div>

    <!-- 8c -->
    <div class="qblock" id="q8c">
      <div class="qtitle">8c. Wie lange können Sie trainieren/üben, wenn Sie bei der Durchführung achillessehnenbelastender Sportarten Schmerzen empfinden, die Sie zum Abbruch der Aktivität zwingen?</div>
      <table class="grid">
        <tr><th>Minuten</th><td>0</td><td>1-10</td><td>11-20</td><td>21-30</td><td>&gt;30</td></tr>
        <tr>
          <th>Punkte</th>
          <td><input type="radio" name="q8c" value="0"></td>
          <td><input type="radio" name="q8c" value="2"></td>
          <td><input type="radio" name="q8c" value="5"></td>
          <td><input type="radio" name="q8c" value="7"></td>
          <td><input type="radio" name="q8c" value="10"></td>
        </tr>
      </table>
    </div>

  </form>

  <button type="button" onclick="calculate()">✅ Score berechnen</button>
  <button type="button" onclick="downloadPDF()">📄 Als PDF speichern</button>

  <div id="result"></div>

  <div style="display:flex; justify-content:center; gap:1rem; margin-top:2rem;">
    <button onclick="goBack()">⬅️ Zurück</button>
    <button onclick="window.location.href='index.html'">🏠 Hauptseite</button>
  </div>

  <script>
    // Berechnung gemäß Vorgabe: Summe /100 *100 (Anzeige auch als Prozent)
    let totalScore = null;

    function getVal(name){
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? Number(el.value) : 0;
    }

    function calculate(){
      // q1..q7: fehlende Antworten = 0
      const s1 = getVal("q1");
      const s2 = getVal("q2");
      const s3 = getVal("q3");
      const s4 = getVal("q4");
      const s5 = getVal("q5");
      const s6 = getVal("q6");
      const s7 = getVal("q7");

      // q8: nur A ODER B ODER C – wenn nichts: 0; wenn mehrere: höchste Wertung wird verwendet
      const a = getVal("q8a");
      const b = getVal("q8b");
      const c = getVal("q8c");
      const s8 = Math.max(a, b, c); // entspricht »eine der drei«; bleibt 0, wenn nichts gewählt

      const sum = s1+s2+s3+s4+s5+s6+s7+s8;
      totalScore = sum;
      const percent = ((sum/100)*100).toFixed(1);

      let note = "";
      if ((a>0)+(b>0)+(c>0) > 1) {
        note = "\nHinweis zu Frage 8: Mehrere Teilfragen gewählt – gewertet wurde die höchste Punktzahl.";
      } else if (a===0 && b===0 && c===0) {
        note = "\nHinweis zu Frage 8: Keine Auswahl – gewertet: 0 Punkte.";
      }

      document.getElementById("result").textContent =
        `Gesamtpunktzahl: ${sum}/100\nProzentwert: ${percent}%` + note;
    }

    function downloadPDF(){
      if (totalScore === null) { alert("Bitte zuerst auf 'Score berechnen' klicken."); return; }
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      if (window.robotoBase64) {
        doc.addFileToVFS("Roboto-Regular.ttf", window.robotoBase64);
        doc.addFont("Roboto-Regular.ttf", "Roboto", "normal");
        doc.setFont("Roboto", "normal");
      }

      let y = 18, left = 15, right = 195, lh = 7;
      doc.setFontSize(16);
      doc.text("VISA-A – Auswertung", left, y); y += lh + 3;
      doc.setFontSize(12);

      const rows = [
        ["1", getSelectedValue("q1")],
        ["2", getSelectedValue("q2")],
        ["3", getSelectedValue("q3")],
        ["4", getSelectedValue("q4")],
        ["5", getSelectedValue("q5")],
        ["6", getSelectedValue("q6")],
        ["7", getSelectedValue("q7")],
        ["8a", getSelectedValue("q8a")],
        ["8b", getSelectedValue("q8b")],
        ["8c", getSelectedValue("q8c")]
      ];

      rows.forEach(([label, val])=>{
        doc.text(`${label}. Antwort: ${val ?? "-"}`, left, y); y += lh;
        if (y > 280) { doc.addPage(); y = 20; }
      });

      y += 4;
      doc.line(left, y, right-10, y); y += 6;
      doc.text(`Gesamtpunktzahl: ${totalScore}/100`, left, y); y += lh;
      doc.text(`Prozentwert: ${((totalScore/100)*100).toFixed(1)}%`, left, y); y += lh;

      doc.save("VISA-A_Auswertung.pdf");

      function getSelectedValue(name){
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : "-";
      }
    }

    function goBack(){
      if (document.referrer && document.referrer !== window.location.href) { history.back(); }
      else { window.location.href = 'index.html'; }
    }
  </script>
</body>
</html>
